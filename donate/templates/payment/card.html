{% extends "pages/base_page.html" %}
{% load i18n form_tags static %}

{% block title %}{% trans "Your information" %}{% endblock %}

{% block template_name %}app--details{% endblock %}

{% block content %}

<div class="layout layout--narrow">
    <div class="layout__container">
        <div class="layout__full-col">
            <div class="payments donate" id="donate__personal-details-wrapper">

                <div class="notification notification--neutral">
                    <div class="notification__container">
                        <div class="notification__message">
                            {% trans "You are donating" %} {{ currency_info.symbol }} {{ form.amount.value|floatformat:"-2" }}
                        </div>
                        <div class="notification__action">
                            <a href="#donate__amount-edit" data-amount-toggle>{% trans "Change amount" %}</a>
                        </div>
                    </div>
                </div>

                <div class="donation-update" data-amount-actions>
                    <div class="donation-update__container">
                        <div class="form-item">
                            <label for="donation-update">{{ currency_info.symbol }}</label>
                            <input type="number" name="donation-update" value="{{ form.amount.value }}" step="1" min="1">
                        </div>
                        <div class="form-item">
                            <button class="button button--primary">{% trans 'Confirm' %}</button>
                        </div>
                    </div>
                </div>

                <h1 class="heading heading--primary">{% trans "Your details" %}</h1>

            </div>

            <div class="donate__form-wrapper">
                <form method="post" class="form" id="payments__braintree-form">
                    <div class="form__container form__container--flex">
                        <div class="form__section form__section--main-column">
                            {% csrf_token %}

                            {% if form.non_field_errors %}
                                {% for error in form.non_field_errors %}
                                <div class="form__errors">{{ error }}</div>
                                {% endfor %}
                            {% elif form.errors %}
                                <div class="form__errors">
                                    {% trans "There were some errors with your form. Please amend the fields highlighted below." %}
                                </div>
                            {% elif gateway_address_errors %}
                                <div class="form__errors">
                                    <p>{% trans "We were unable to take payment because the payment processor reported an error with your address information:" %}</p>
                                    {% for error in gateway_address_errors %}
                                    <p><strong>{{ error }}</strong></p>
                                    {% endfor %}
                                    {% trans "Please correct these errors and try again." %}
                                </div>
                            {% endif %}

                            {% render_form_field form.amount %}
                            {% render_form_field form.first_name %}
                            {% render_form_field form.last_name %}
                            {% render_form_field form.email %}
                            {% render_form_field form.address_line_1 %}
                            {% render_form_field form.town %}
                            {% render_form_field form.post_code %}
                            {% render_form_field form.country %}

                            {% render_form_field form.braintree_nonce %}

                        </div>

                        <div id="payments__braintree-errors-card" hidden></div>

                        <div class="form-item">
                            <label for="card-number">Card number</label>
                            <div class="form-item__wrapper payments__braintree-hosted-field" id="card-number"></div>
                        </div>

                        <div class="form-item">
                            <label for="cvv">Card security code</label>
                            <div class="form-item__tooltip-wrapper">
                                <div class="form-item__wrapper payments__braintree-hosted-field" id="cvv"></div>
                            </div>
                        </div>

                        <div class="form-item">
                            <label for="expiration-date">Expiration date</label>
                            <div class="form-item__wrapper payments__braintree-hosted-field" id="expiration-date"></div>
                        </div>

                        <div class="form__section form__section--actions">

                            <button value="donate" class="button button--large button--full button--primary button--icon" id="payments__payment-submit" disabled>
                                <svg class="button__icon" width="24" height="24">
                                    <use xlink:href="#padlock"></use>
                                </svg>
                                {% blocktrans with symbol=currency_info.symbol amount=form.amount.value|floatformat:"-2" %}Donate {{ symbol }} {{ amount }}{% endblocktrans %}
                            </button>

                        </div>

                        <footer class="donate__footer">
                            {% trans 'Your donation helps keep the Web open and free. Thank you in advance for your gift' %}
                            LOGOS TBD
                        </footer>

                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}


{% block extra_js %}
    {{ braintree_params|json_script:"payments__braintree-params" }}
    <script src="{% static '_js/payments-card.compiled.js' %}"></script>
{% endblock %}
